"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1776],{49613:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(59496);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=c(n),m=i,d=h["".concat(s,".").concat(m)]||h[m]||g[m]||r;return n?a.createElement(d,o(o({ref:t},p),{},{components:n})):a.createElement(d,o({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8374:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=n(62081),i=(n(59496),n(49613));const r={title:"\u5355\u56fe\u7247\u4e0a\u4f20pro(\u5e26\u538b\u7f29\u7248)",date:new Date("2018-12-11T00:00:00.000Z"),categories:"js",tags:["imgUploadPro"]},o=void 0,l={permalink:"/blog/2018/12/11/imguploadpro",source:"@site/blog/2018-12-11-imguploadpro.md",title:"\u5355\u56fe\u7247\u4e0a\u4f20pro(\u5e26\u538b\u7f29\u7248)",description:"\u5355\u56fe\u7247\u505a\u5b8c\u4e4b\u540e\u53d1\u73b0\u624b\u673a\u62cd\u7167\u7167\u7247\u90fd\u5f88\u5927\uff0c\u57fa\u672c\u90fd\u57284\u30015M\uff0c\u4e0a\u4f20\u901f\u5ea6\u6709\u4e9b\u6162\uff0c\u7136\u540e\u5c31\u5bfb\u627e\u65b9\u6cd5\uff0c\u5f00\u59cb\u60f3\u4f7f\u7528\u56fe\u7247\u8f6cbase64\u7ed9\u540e\u53f0\uff0c\u4f46\u662f\u53d1\u73b0\u540e\u53f0\u4e0d\u652f\u6301base64,\u7136\u540e\u5bfb\u6c42\u4ed6\u8def\uff0c\u53d1\u73b0\u7ed9\u4ee5\u628a\u56fe\u7247\u8f6c\u6362\u6210canvas\u8fdb\u884c\u538b\u7f29\u3002",date:"2018-12-11T00:00:00.000Z",formattedDate:"2018\u5e7412\u670811\u65e5",tags:[{label:"imgUploadPro",permalink:"/blog/tags/img-upload-pro"}],readingTime:3.35,hasTruncateMarker:!1,authors:[],frontMatter:{title:"\u5355\u56fe\u7247\u4e0a\u4f20pro(\u5e26\u538b\u7f29\u7248)",date:"2018-12-11T00:00:00.000Z",categories:"js",tags:["imgUploadPro"]},prevItem:{title:"blob\u517c\u5bb9\u6027\u95ee\u9898",permalink:"/blog/2018/12/26/toBlob"},nextItem:{title:"IntersectionObserver API",permalink:"/blog/2018/12/03/IntersectionObserver"}},s={authorsImageUrls:[]},c=[],p={toc:c};function g(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"\u5355\u56fe\u7247\u505a\u5b8c\u4e4b\u540e\u53d1\u73b0\u624b\u673a\u62cd\u7167\u7167\u7247\u90fd\u5f88\u5927\uff0c\u57fa\u672c\u90fd\u57284\u30015M\uff0c\u4e0a\u4f20\u901f\u5ea6\u6709\u4e9b\u6162\uff0c\u7136\u540e\u5c31\u5bfb\u627e\u65b9\u6cd5\uff0c\u5f00\u59cb\u60f3\u4f7f\u7528\u56fe\u7247\u8f6cbase64\u7ed9\u540e\u53f0\uff0c\u4f46\u662f\u53d1\u73b0\u540e\u53f0\u4e0d\u652f\u6301base64,\u7136\u540e\u5bfb\u6c42\u4ed6\u8def\uff0c\u53d1\u73b0\u7ed9\u4ee5\u628a\u56fe\u7247\u8f6c\u6362\u6210canvas\u8fdb\u884c\u538b\u7f29\u3002"),(0,i.kt)("p",null,"\u4ee3\u7801\u5982\u4e0b\uff08\u8fd8\u662f\u9700\u8981\u4f9d\u8d56jq\uff09"),(0,i.kt)("p",null,"html"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'<div class="imgUpload">\n    <input type="file" accept="image/*" capture="camera" class="imgUploadIpt">\n    <img src="1.png" alt="">\n</div>\n')),(0,i.kt)("p",null,"css"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},".imgUpload {\n    width: 88px;\n    height: 88px;\n    position: relative;\n}\n.imgUpload input[type='file'] {\n    width: 100%;\n    height: 100%;\n    opacity: 0;\n    position: absolute;\n    z-index: 2;\n}\n.imgUpload img {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    z-index: 1;\n}\n")),(0,i.kt)("p",null,"js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"function ImgUpload(ele, files, options ) {\n    this.ele = ele;//\u70b9\u51fb\u7684input\u5143\u7d20\n    this.files = files;//\u56fe\u7247file\n    this.compression = options.compression || false;//\u662f\u5426\u5f00\u542f\u538b\u7f29\u9ed8\u8ba4\u5426\n    this.maxWidth = options.maxWidth || 800;//\u538b\u7f29\u6700\u5927\u5bbd\u5ea6\n    this.maxHeight = options.maxHeight || 800;//\u538b\u7f29\u6700\u5927\u9ad8\u5ea6\n    this.callback = options.callback;//\u56de\u8c03\n    this.init();\n}\nImgUpload.prototype = {\n    init: function () {\n        this.onChangeUploadFile();\n    },\n    onChangeUploadFile: function () {\n        var _this = this;\n        //\u5224\u65ad\u6587\u4ef6\u662f\u5426\u6dfb\u52a0\u8fdb\u6765\n        if (this.files.length == 0) {\n            return false;\n        }\n        var file = this.files[0];\n        //\u5224\u65ad\u4e0a\u4f20\u7684\u662f\u4e0d\u662f\u56fe\u7247\n        if (file.type.indexOf('image') === -1) {\n            alert(\"\u60a8\u4e0a\u4f20\u7684\u4e0d\u662f\u56fe\u7247\uff01\");\n            return false;\n        }\n        //\u4e0a\u4f20\u56fe\u7247\u8fdb\u884c\u6700\u5927\u9650\u5236\n        var filesize = Math.floor((file.size) / 1024);\n        if (filesize > 1024 * 20) {\n            alert(\"\u4e0a\u4f20\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc720M.\");\n            return false;\n        }\n        this.ele.parent().find(\"img\").attr(\"src\", window.URL.createObjectURL(file));\n        if( !this.compression ) {\n            if (this.callback) {\n                this.callback( file );\n            }\n        }else {\n            // \u538b\u7f29\u56fe\u7247\u9700\u8981\u7684\u4e00\u4e9b\u5143\u7d20\u548c\u5bf9\u8c61\n            var reader = new FileReader(), img = new Image();\n            //result\u5c5e\u6027\u4e2d\u5c06\u5305\u542b\u4e00\u4e2adata: URL\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u4ee5\u8868\u793a\u6240\u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\n            reader.readAsDataURL(file);\n            // \u6587\u4ef6base64\u5316\uff0c\u4ee5\u4fbf\u83b7\u77e5\u56fe\u7247\u539f\u59cb\u5c3a\u5bf8\n            reader.onload = function(e) {\n                img.src = e.target.result;\n            };\n            // \u7f29\u653e\u56fe\u7247\u9700\u8981\u7684canvas\n            var canvas = document.createElement('canvas');\n            var context = canvas.getContext('2d');\n            img.onload = function () {\n                // \u56fe\u7247\u539f\u59cb\u5c3a\u5bf8\n                var originWidth = this.width;\n                var originHeight = this.height;\n                // \u6700\u5927\u5c3a\u5bf8\u9650\u5236\n                var maxWidth = _this.maxWidth, maxHeight = _this.maxHeight;\n                // \u76ee\u6807\u5c3a\u5bf8\n                var targetWidth = originWidth, targetHeight = originHeight;\n                // \u56fe\u7247\u5c3a\u5bf8\u8d85\u8fc7\u9650\u5236\n                if (originWidth > maxWidth || originHeight > maxHeight) {\n                    if (originWidth / originHeight > maxWidth / maxHeight) {\n                        // \u66f4\u5bbd\uff0c\u6309\u7167\u5bbd\u5ea6\u9650\u5b9a\u5c3a\u5bf8\n                        targetWidth = maxWidth;\n                        targetHeight = Math.round(maxWidth * (originHeight / originWidth));\n                    } else {\n                        targetHeight = maxHeight;\n                        targetWidth = Math.round(maxHeight * (originWidth / originHeight));\n                    }\n                }\n                // canvas\u5bf9\u56fe\u7247\u8fdb\u884c\u7f29\u653e\n                canvas.width = targetWidth;\n                canvas.height = targetHeight;\n                // \u6e05\u9664\u753b\u5e03\n                context.clearRect(0, 0, targetWidth, targetHeight);\n                // \u56fe\u7247\u538b\u7f29\n                context.drawImage(img, 0, 0, targetWidth, targetHeight);\n                // canvas\u8f6c\u4e3ablob\u8fd4\u56de\n                canvas.toBlob(function (blob) {\n                    if (_this.callback) {\n                        _this.callback( blob );\n                    }\n                }, file.type || 'image/png');\n            };\n        }\n    }\n}\n\n$('.imgUploadIpt').on('change', function (event) {\n    new ImgUpload($(this), event.target.files, {\n        compression: true, //\u5f00\u542f\u538b\u7f29\u9ed8\u8ba4\u4e0d\u538b\u7f29\n        maxWidth: 600, //\u5f00\u542f\u538b\u7f29\u56fe\u7247\u6700\u5927\u5bbd\u5ea6\n        maxHeight: 600, //\u5f00\u542f\u538b\u7f29\u56fe\u7247\u6700\u5927\u9ad8\u5ea6\n        callback:function (file) {//\u56de\u8c03\u51fd\u6570\n            console.log(file);\n        }\n    })\n})\n")),(0,i.kt)("a",{href:"/2018-12-11",target:"\\_black"},"\u5177\u4f53\u6548\u679c\u70b9\u51fb\u8fd9\u91cc"),(0,i.kt)("p",null,"\u53c2\u8003\u5730\u5740\n",(0,i.kt)("a",{parentName:"p",href:"https://www.zhangxinxu.com/wordpress/2017/07/html5-canvas-image-compress-upload/"},"https://www.zhangxinxu.com/wordpress/2017/07/html5-canvas-image-compress-upload/"),";"))}g.isMDXComponent=!0}}]);